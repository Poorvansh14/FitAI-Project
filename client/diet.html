<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>FitAI | Diet Planner</title>

    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Rubik:wght@700,500,900&family=Montserrat:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css">
    <link rel="icon" type="image/png" href="/assets/logo.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="manifest" href="assets/site.webmanifest">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <style>
        :root {
            --primary: #00FFC2;
            --primary-dark: #009e75;
            --accent: #0d0f2b;
            --bg: #f9fafb;
            --text: #19223E;
            --muted: #7b7b8a;
            --feature-bg: rgba(245,245,250,0.92);
            --card-blur: 18px;
            --nav-height: 72px;
            --shadow: 0 8px 24px rgba(0, 28, 80, 0.10);
            --gradient: linear-gradient(120deg,#00ffc2,#6e7fff 80%);
            --transition: .4s cubic-bezier(.53,0,.36,1.6);
            --nav-link-underline: #00ffc2;
        }
        [data-theme=dark] {
            --bg: #181926;
            --text: #f5f7fa;
            --muted: #94a3b8;
            --feature-bg: rgba(31,33,54,0.92);
            --shadow: 0 8px 24px rgba(0, 28, 80, 0.17);
            --nav-link-underline: #6e7fff;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }

        
        body {
            font-family: 'Montserrat', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            scroll-behavior: smooth;
            transition: background .5s, color .5s;
        }
        a { color: inherit; text-decoration: none; }
        img { max-width: 100%; display: block; border-radius: 16px; }
        .loader-img {
            position:fixed; z-index:11000; left:0; top:0;width:100vw;height:100vh;
            background:var(--bg);
            display: flex;align-items:center;justify-content:center;
            transition: opacity 0.5s;
        }
        .navbar {
            height: var(--nav-height);
            display: flex; align-items:center; justify-content:space-between; flex-wrap:wrap;
            padding: 0 .8rem; background: var(--feature-bg); box-shadow: var(--shadow);
            position: sticky; top: 0; z-index: 900;
            backdrop-filter: blur(8px);
            transition: background .5s, box-shadow .3s;
        }
        .navbar.scrolled {
            box-shadow: 0 4px 18px rgba(0, 28, 80, 0.15);
        }
        .navbar.scrolled::after {
            content: '';
            position: absolute; left: 0; right: 0; bottom: -4px; height: 3px;
            background: linear-gradient(90deg, #00ffc2 0%, #6e7fff 100%);
            opacity: 0.6; border-radius: 2px;
            pointer-events: none;
            animation: navGlow .5s;
        }
        @keyframes navGlow {
            from { opacity: 0; }
            to { opacity: 0.6; }
        }
        .logo span {
            font-family: 'Rubik', sans-serif;
            font-size: 2.1rem; font-weight: 900; letter-spacing: -2px;
            color: var(--primary);
            background: var(--gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: .2em .1em;
            transition: transform 0.2s ease-out;
        }
        .logo:hover span {
            transform: scale(1.05);
        }
        nav ul {
            display: flex; gap: 2rem; align-items: center; list-style: none;
            font-size: 1.13rem; font-weight: 500;
        }
        nav ul li a {
            position: relative; padding: .3em .7em; border-radius: 6px;
            transition: color .45s cubic-bezier(.6,1.7,.4,1),
                        text-shadow .22s cubic-bezier(.53,0,.32,1), transform .2s ease-out;
        }
        nav ul li a.active, nav ul li a:hover {
            color: var(--primary);
            transform: translateY(-2px);
            text-shadow: 0 2px 16px #00ffc264;
        }
        nav ul li a::after {
            content:'';
            position:absolute;bottom:-5px;left:0;width:100%; height: 2px;
            background: var(--nav-link-underline); border-radius: 2px;
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        }
        nav ul li a.active::after, nav ul li a:hover::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }
        .nav-toggle { display:none;cursor:pointer;font-size:2rem;background: none;border:none; transition: color .3s;}
        .nav-toggle:hover { color: var(--primary); }
        @media (max-width:800px) {
            nav ul {
                flex-direction: column; gap:1.1rem;background:var(--feature-bg);position:fixed;right:0;top:var(--nav-height);width:60vw;max-width:340px;padding:2rem 1.5rem 2rem 2rem;box-shadow: -20px 0 40px -13px rgba(0,0,0,0.13);height:100vh;transform:translateX(100%);transition: transform .35s;z-index:100;
                border-left: 1px solid rgba(0,255,194,.1);
            }
            nav ul.open { transform: none;}
            .nav-toggle { display:inline-block;}
        }
        .theme-toggle {
            background: radial-gradient(circle, #00ffc2 20%, #6e7fff 90%);
            border: 2px solid rgba(0,255,194,0.3);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0,255,194,0.3);
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(0,255,194,0.55);
        }
        
        .theme-toggle i {
            filter: drop-shadow(0 0 4px rgba(0,255,194,0.7));
        }
        
        /* For dark mode */
        [data-theme="dark"] .theme-toggle {
            background: radial-gradient(circle, #6e7fff 30%, #00ffc2 90%);
            color: #fff;
            box-shadow: 0 0 25px rgba(110,127,255,0.55);
        }

        
        .theme-toggle:hover {
            transform: scale(1.08);
            background: var(--primary-dark);
            color: var(--bg);
        }
        .theme-toggle:active {
            transform: scale(0.95);
        }
        .main-hero {
            display: flex; align-items: flex-start; justify-content: center; min-height: 66vh; padding: 6vw 5vw; gap: 3vw; flex-wrap: wrap;
        }
        .main-hero-content {
            flex:1 1 320px; max-width: 500px;
        }
        .main-hero-content h1 {
            font-family:'Rubik', sans-serif; font-size:clamp(2.2rem,4vw,3rem); font-weight:900; color:var(--primary);
            line-height:1.1; letter-spacing: -.02em; margin-bottom:.7em;
            background: linear-gradient(87deg,#00ffc2,#6e7fff 60%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .main-hero-content p {
            color: var(--muted); font-size:1.18rem; margin-bottom:2em; margin-top:.2em;
        }
        .diet-form {
            background: var(--feature-bg);
            border-radius:22px; padding:2.7em 2em; box-shadow: var(--shadow);
            display:flex; flex-direction:column; gap: 1.2em; margin-top:1vw;
            max-width: 470px; margin-left:auto;margin-right:auto;
            backdrop-filter: blur(var(--card-blur));
        }
        .diet-form label {font-weight:700; color: var(--text);}
        .diet-form input, .diet-form select, .diet-form button {
            padding: 1em 1.1em; border-radius:9px; border:1.5px solid #c6f4ea35; outline:none; font-size:1rem;
            background:rgba(240,255,254,.74);
            color: var(--text);
            transition: box-shadow 0.23s, border-color 0.18s, background 0.23s, color 0.23s;
        }
        .diet-form input:focus, .diet-form select:focus {
            border-color: #6e7fff;
            box-shadow: 0 2px 14px #00ffc251;
            background: #fff;
        }
        [data-theme="dark"] .diet-form input,
        [data-theme="dark"] .diet-form select {
            background: #25273a;
            color: #f5f7fa;
            border-color: #445 !important;
        }
        .diet-form button {
            background: var(--gradient); color: #fff;
            font-family:inherit;font-weight:800;font-size:1.17rem;border:none;
            box-shadow:0 1.5px 16px rgba(0,255,194,.10);margin-top:.7em; cursor:pointer;
            transition: transform 0.14s, box-shadow 0.15s;
        }
        .diet-form button:hover {
            transform:translateY(-3px) scale(1.04);
            box-shadow:0 4px 32px rgba(14,255,190,.17);
        }
        @media (max-width:900px){ .main-hero { flex-direction:column; text-align:center; gap:2vw; } }
        @media (max-width:600px){
            .main-hero-content h1{font-size:2rem;}
            .diet-form{padding:1.2em 0.9em;}
        }
        footer {
            text-align:center;
            color:var(--muted); background: var(--feature-bg); padding:2.2em 0 1.5em 0;
            font-size:.97rem; letter-spacing:.01em;border-top:1px solid #eee;box-shadow: var(--shadow);margin-top:2vw;
            transition: background .5s, border-color .5s;
        }
        #diet-result {
            margin-top: 2em;
            background: var(--feature-bg);
            color: var(--text);
            padding: 1.5em 1em;
            border-radius: 15px;
            box-shadow: 0 4px 20px #ccffef33;
            text-align: left;
            min-height: 0;
            display: block;
            opacity: 0;
            transform: translateY(32px) scale(0.97);
            pointer-events: none;
            transition:
              opacity 0.42s cubic-bezier(.42,0,.5,1.0),
              transform 0.42s cubic-bezier(.42,0,.5,1.0),
              background 0.4s, color 0.4s;
        }
        #diet-result.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }
        [data-theme="dark"] #diet-result {
            background: rgba(44,48,72,0.96);
            color: #f5f7fa;
            box-shadow: 0 4px 20px #00ffc222;
        }
        #diet-result ul { margin: .8em 0 0 1.3em; line-height: 1.7; }
        #diet-result h3 { margin: 0; font-size: 1.18em; color: var(--primary); }
        .modal {
            display:none; position:fixed;z-index:1101;left:0;top:0;width:100vw;height:100vh;
            background: rgba(0,0,0, 0.30); backdrop-filter: blur(1.7px);
            align-items:center;justify-content:center;
            animation: fadeInModalBg .55s;
        }
        .modal-content {
            background:rgba(255,255,255,.18);
            border-radius: 25px;
            box-shadow: 0 20px 80px rgba(0,255,194,0.14),0 5px 56px rgba(40,40,105,0.04);
            padding: 2.6em 2.2em 1.7em 2.2em; max-width:370px;width:calc(98vw - 30px);
            margin:2vw auto;display:flex;flex-direction:column;align-items:center;
            animation: modalAppear .7s cubic-bezier(.25,1.4,.65,.94);
            border:1.5px solid var(--primary-dark);
            position:relative;
            color:var(--text);
            transition: background .35s, border-color .35s;
        }
        .modal-content h2 { font-family:'Rubik';font-weight:800;font-size:1.31rem;margin:0 0 .8em 0;color:var(--primary);}
        .modal-content input[type="text"], .modal-content input[type="email"], .modal-content input[type="password"]{
            width:100%;padding:.87em 1.2em;margin-bottom:1.1em;
            border:1.5px solid #c6f4ea25;border-radius:8px;
            background:rgba(240,255,254,.86);color:var(--text);
            font-size:1.09em;transition: border-color .25s, background .25s, color .25s;outline:none;
        }
        /* START: Dark Mode Modal Input Fix */
        [data-theme="dark"] .modal-content input[type="text"],
        [data-theme="dark"] .modal-content input[type="email"],
        [data-theme="dark"] .modal-content input[type="password"]{
            background:#26283a; /* Darker background */
            color:#f5f7fa; /* Light text color for readability */
            border-color:#3d415f;
        }
        .modal-content input::placeholder{ color:#7b7b8a; }
        [data-theme="dark"] .modal-content input::placeholder{ color:#a7b0c4; }
        /* END: Dark Mode Modal Input Fix */
        .modal-content input:focus,
        .modal-content input[type="email"]:focus,
        .modal-content input[type="password"]:focus {
            box-shadow: 0 2px 18px #00ffc271;
            border-color: #6e7fff;
            background: rgba(240,255,254,1);
        }
        .modal-content button { width:100%;font-size:1.05em;padding:.85em;margin-top:.5em;}
        .close {
            position:absolute;top:16px; right:16px;font-size:1.5em;cursor:pointer; color:var(--primary);
            transition:.2s;font-weight:bold;
            transition: color .3s, transform .2s;
        }
        .close:hover { color:#ff002e; transform: rotate(90deg);}
        .small-text {
            margin-top:1em;font-size:0.97em;color:var(--muted);text-align:center;
        }
        .small-text a {
            color: var(--primary);
            font-weight: 700;
            transition: color .3s;
        }
        .small-text a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        .password-wrapper{ position:relative;}
        .toggle-eye{
            position:absolute; right:16px;top:50%;transform:translateY(-50%);
            font-size:1.05em; color:var(--muted);cursor:pointer;padding:2px 1px;
            transition: color .3s;
        }
        .toggle-eye:hover { color:var(--primary); }
        .modal.show { display:flex;animation:fadeInModalBg .5s;}
        @media (max-width:580px){
            .hero{padding: 2.5em 1em;}
            .modal-content{padding:1.7em 1.2em;}
        }

        #loginBtn {
            background: linear-gradient(120deg, #00ffc2, #6e7fff 80%);
            color: #fff;
            font-weight: 700;
            border-radius: 6px;
            padding: 0.45em 1.2em;
            box-shadow: 0 3px 20px rgba(0, 255, 194, 0.2);
            transition: all 0.3s ease-in-out;
        }

        #loginBtn:hover {
          box-shadow: 0 6px 28px rgba(0, 255, 194, 0.35);
          transform: translateY(-2px);
        }
        /* Fix for Login/Signup buttons inside modal popup */
        .modal-content .btn {
          background: linear-gradient(120deg, #00ffc2, #6e7fff 80%);
          color: #fff;
          font-weight: 700;
          border: none;
          border-radius: 8px;
          width: 100%;
          padding: 0.75em 0;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 3px 18px rgba(0, 255, 194, 0.18);
        }
        
        .modal-content .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 28px rgba(0, 255, 194, 0.35);
        }
        @keyframes fadeInModalBg{ from{ opacity: 0;}to{opacity:1;} }
        @keyframes modalAppear{ from{transform:scale(.83) translateY(60px);opacity:0;} to{transform:none;opacity:1;} }
        @keyframes fadeInTop{from{opacity:0;transform:translateY(-45px);}to{opacity:1;transform:none;}}
        @keyframes floatImg{to{transform: translateY(-14px) scale(1.015);} }
        @keyframes fadeInPulse{ 0%{ opacity:0; transform:scale(.8);}
            70%{opacity:.54; transform: scale(1.03);}
            100%{opacity:.73;transform:scale(1);} }
        .reveal { opacity:0; transform: translateY(36px) scale(0.98); transition:all 1s cubic-bezier(.7,0,.3,1);}
        .reveal.visible{ opacity:1;transform:none;}
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }
    </style>
</head>
<body data-theme="light">
<div class="loader-img">
    <svg width="140" height="44" viewBox="0 0 140 44" fill="none" xmlns="http://www.w3.org/2000/svg">
        <text x="0" y="34" font-family="Rubik, sans-serif" font-size="38" font-weight="900" fill="#00ffc2">
            Fit<tspan fill="#222">AI</tspan>
        </text>
    </svg>
</div>
<header class="navbar" id="navbar">
    <div class="logo">
        <span>FitAI</span>
    </div>
    <button class="nav-toggle" id="navToggle" aria-label="Open menu"><i class="ri-menu-3-line"></i></button>
    <nav>
        <ul id="navMenu">
            <li><a href="index.html">Home</a></li>
            <li><a href="workout.html">Workout</a></li>
            <li><a href="diet.html" class="active">Diet</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="#" id="loginBtn">Login</a></li>
        </ul>
    </nav>
    <button id="themeToggle" class="theme-toggle" title="Toggle Theme"><i class="ri-moon-fill"></i></button>
</header>
<section class="main-hero">
    <div class="main-hero-content">
        <h1>AI-Powered<br>Diet Planner</h1>
        <p>Smarter meal plans for any goal, cuisine, and dietary needs. Enter your details and get your personalized plan.</p>
    </div>
    <form class="diet-form" autocomplete="off">
        <label for="weight">Weight (kg):</label>
        <input type="number" id="weight" placeholder="e.g. 72" min="30" max="250" required>
        <label for="height">Height (cm):</label>
        <input type="number" id="height" placeholder="e.g. 175" min="100" max="250" required>

        <label for="gender">Gender:</label>
        <select id="gender" required>
            <option value="">Select Gender</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
        </select>


        <label for="goal">Dietary Goal:</label>
        <select id="goal" required>
            <option value="">Select Goal</option>
            <option>Fat Loss</option>
            <option>Lean Muscle Gain</option>
            <option>Body Recomposition</option>
            <option>Balanced Nutrition</option>
        </select>
        <label for="cuisine">Preferred Cuisine:</label>
        <select id="cuisine">
            <option value="">No Preference</option>
            <option>Mediterranean</option>
            <option>Asian</option>
            <option>Indian</option>
            <option>Low-Carb</option>
            <option>Vegan</option>
        </select>
        <label for="food-preference">Food Preference:</label>
        <select id="food-preference" required>
            <option value="">Select Preference</option>
            <option>Vegetarian</option>
            <option>Non-Vegetarian</option>
            <option>Vegan</option>
        </select>
        <label for="restrictions">Dietary Restrictions/Allergies:</label>
        <input type="text" id="restrictions" placeholder="e.g. Gluten-free, Dairy-free">
        <label for="meals">Meals per day:</label>
        <select id="meals" required>
            <option value="3">3 Meals</option>
            <option value="4">4 Meals</option>
            <option value="5">5 Meals</option>
        </select>
        <button type="submit" class="btn">Get My Plan</button>
    </form>
    <div id="diet-result"></div>
</section>
<footer>
    <p>&copy; 2025 FitAI &mdash; Your ultimate AI fitness sidekick</p>
</footer>

<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Sign in to FitAI</h2>
        <form id="loginForm">
            <input id="loginUsername" autocomplete="username" type="text" placeholder="Username or Email" required />
            <div class="password-wrapper">
                <input id="loginPassword" autocomplete="current-password" type="password" placeholder="Password" required />
                <span class="toggle-eye" id="togglePassword"><i class="ri-eye-line"></i></span>
            </div>
            <button type="submit" class="btn">Login</button>
            <p class="small-text">Don't have an account? <a href="#" id="openSignup">Sign up</a></p>
        </form>
    </div>
</div>
<div id="signupModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeSignup">&times;</span>
    <h2>Create Your FitAI Account</h2>
    <form id="signupForm">
  <input id="signupUsername" type="text" placeholder="Username" required />
  <input id="firstName" type="text" placeholder="First Name" required />
  <input id="lastName" type="text" placeholder="Last Name" required />
  <input id="signupEmail" type="email" placeholder="Email Address" required />
  <input id="signupPassword" type="password" placeholder="Create Password" required />
  <input id="confirmPassword" type="password" placeholder="Confirm Password" required />
  <button type="submit" class="btn">Sign Up</button>
      <p class="small-text">Already have an account? <a href="#" id="openLogin">Login</a></p>
    </form>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    // Hamburger nav
    const navToggle = document.getElementById("navToggle");
    const navMenu = document.getElementById("navMenu");
    navToggle.onclick = () => navMenu.classList.toggle("open");

    /* ---------------- MODALS ---------------- */
const loginBtn = document.getElementById("loginBtn");
const loginModal = document.getElementById("loginModal");
const closeModal = document.getElementById("closeModal");
const signupModal = document.getElementById("signupModal");
const closeSignup = document.getElementById("closeSignup");
const openSignup = document.getElementById("openSignup");
const openLogin = document.getElementById("openLogin");

loginBtn.onclick = () => loginModal.classList.add("show");
closeModal.onclick = () => loginModal.classList.remove("show");
closeSignup.onclick = () => signupModal.classList.remove("show");

if (openSignup)
  openSignup.onclick = (e) => {
    e.preventDefault();
    loginModal.classList.remove("show");
    signupModal.classList.add("show");
  };

if (openLogin)
  openLogin.onclick = (e) => {
    e.preventDefault();
    signupModal.classList.remove("show");
    loginModal.classList.add("show");
  };

window.onclick = (e) => {
  if (e.target === loginModal) loginModal.classList.remove("show");
  if (e.target === signupModal) signupModal.classList.remove("show");
};
    // Password toggle
    const pw = document.getElementById("loginPassword");
    const tgl = document.getElementById("togglePassword");
    tgl.onclick = () => {
        pw.type = pw.type === "password" ? "text" : "password";
        tgl.innerHTML = pw.type === "password"
            ? '<i class="ri-eye-line"></i>'
            : '<i class="ri-eye-off-line"></i>';
    }

    // Theme toggling
    const themeToggle = document.getElementById("themeToggle");
    const body = document.body;
    const moon = '<i class="ri-moon-fill"></i>';
    const sun = '<i class="ri-sun-fill"></i>';
    let mode = localStorage.getItem("theme") || "light";
    if (mode !== body.getAttribute("data-theme")) {
        body.setAttribute("data-theme", mode);
        themeToggle.innerHTML = mode === "dark" ? sun : moon;
    }
    themeToggle.onclick = () => {
        const t = body.getAttribute("data-theme") === "dark" ? "light" : "dark";
        body.setAttribute("data-theme", t);
        localStorage.setItem("theme", t);
        themeToggle.innerHTML = t === "dark" ? sun : moon;
    }

    // Loader fade-out
    window.addEventListener("load", () => {
        document.querySelector(".loader-img")?.style.setProperty("display", "none");
    });

    // Section scroll-reveal
    function inView(el) {
        return el.getBoundingClientRect().top < window.innerHeight * .92;
    }
    function revealSections() {
        document.querySelectorAll(".reveal").forEach(el => {
            if (inView(el)) el.classList.add("visible");
        });
    }
    window.addEventListener("scroll", revealSections);
    window.addEventListener("load", revealSections);

 /* ---------------- LOGIN ---------------- */
const loginForm = document.getElementById("loginForm");
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const payload = {
    email: document.getElementById("loginUsername").value,
    password: document.getElementById("loginPassword").value,
  };

  try {
    const res = await fetch("http://localhost:5000/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    const data = await res.json();
    if (res.ok) {
      loginModal.classList.remove("show");
      alert("‚úÖ Login successful! Welcome, " + data.username);
      loginBtn.innerText = `Hi, ${data.username}`;
    } else {
      alert("‚ùå Login failed: " + (data.error || "Invalid credentials"));
    }
  } catch (err) {
    alert("‚ö†Ô∏è Could not connect to backend. Check if Flask is running.");
  }
});

/* ---------------- SIGNUP ---------------- */
// Signup form: POST to /api/signup
const signupForm = document.getElementById("signupForm");
signupForm.onsubmit = async (e) => {
    e.preventDefault();
    const payload = {
        username: document.getElementById("signupUsername").value,
        email: document.getElementById("signupEmail").value,
        password: document.getElementById("signupPassword").value
    };
    console.log("Signup form payload:", payload);
    try {
        const res = await fetch("http://127.0.0.1:5000/api/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        console.log("Signup response:", data);
        if (res.ok) {
            alert("‚úÖ Signup successful! Please log in.");
            signupModal.classList.remove("show");
            loginModal.classList.add("show");
        } else {
            alert("‚ùå Signup failed: " + (data.error || "Please try again."));
        }
    } catch (err) {
        console.error("Signup error:", err);
        alert("‚ö†Ô∏è Could not connect to backend.");
    }
};

    // Navbar Scroll Effect
    const navbar = document.getElementById("navbar");
    window.addEventListener("scroll", () => {
        if (window.scrollY > 50) {
            navbar.classList.add("scrolled");
        } else {
            navbar.classList.remove("scrolled");
        }
    });

    // Button Ripple Effect
    document.querySelectorAll('.btn').forEach(button => {
        button.addEventListener('click', function (e) {
            const circle = document.createElement('span');
            const diameter = Math.max(this.clientWidth, this.clientHeight);
            const radius = diameter / 2;
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${e.clientX - this.offsetLeft - radius}px`;
            circle.style.top = `${e.clientY - this.offsetTop - radius}px`;
            circle.classList.add('ripple');
            this.appendChild(circle);
            circle.addEventListener('animationend', () => circle.remove());
        });
    });

    // Dynamic result card animation
    function showResultWithSmoothEffect(html) {
        const resultDiv = document.getElementById('diet-result');
        resultDiv.classList.remove('visible');
        requestAnimationFrame(() => {
            resultDiv.innerHTML = html;
            requestAnimationFrame(() => {
                resultDiv.classList.add('visible');
            });
        });
    }

    // ‚úÖ AI + Flask Diet Generation Logic
    document.querySelector('.diet-form').onsubmit = async function (e) {
        e.preventDefault();
        showResultWithSmoothEffect(`<span style="color:var(--muted);">üçΩÔ∏è Generating your personalized diet plan...</span>`);

        const payload = {
            weight: document.getElementById('weight').value,
            goal: document.getElementById('goal').value,
            cuisine: document.getElementById('cuisine').value,
            preference: document.getElementById('food-preference').value,
            restrictions: document.getElementById('restrictions').value,
            meals: document.getElementById('meals').value
        };

        try {
            const res = await fetch("http://localhost:5000/api/generate_diet", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await res.json();

            if (data.plan && data.plan.details) {
                const formatted = data.plan.details
                    .replace(/\n/g, "<br>")
                    .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>");

                showResultWithSmoothEffect(`
                    <h3 style="color: var(--primary-dark); margin-bottom: 10px;">Your AI Diet Plan</h3>
                    <p><b>Goal:</b> ${document.getElementById('goal').value}</p>
                    <div style="margin-top:1em;white-space:pre-line;">
                        ${formatted}
                    </div>
                `);
            } else {
                showResultWithSmoothEffect(`<span style="color:crimson;">Error: ${data.error || "Failed to generate diet plan."}</span>`);
            }
        } catch (error) {
            console.error("‚ùå Error fetching AI diet plan:", error);
            showResultWithSmoothEffect(`<span style="color:crimson;">Server error. Please ensure Flask backend is running.</span>`);
        }
    };
    
document.addEventListener("DOMContentLoaded", () => {
  const { jsPDF } = window.jspdf;
  const resultDiv = document.getElementById("diet-result");

  // Create download button with matching style
  const downloadBtn = document.createElement("button");
  downloadBtn.textContent = "Download as PDF";
  downloadBtn.className = "btn";
  downloadBtn.style.cssText = `
    background: linear-gradient(120deg, #00ffc2, #6e7fff);
    color: #fff;
    font-weight: 700;
    border: none;
    padding: 0.6em 1.5em;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 24px rgba(0, 255, 194, 0.18);
    margin-top: 1.5em;
    display: none;
  `;

  // Hover effect (Optional: copied for consistency)
  downloadBtn.addEventListener("mouseenter", () => {
    downloadBtn.style.transform = "translateY(-2px) scale(1.03)";
    downloadBtn.style.boxShadow = "0 4px 32px rgba(14, 255, 190, 0.3)";
  });
  downloadBtn.addEventListener("mouseleave", () => {
    downloadBtn.style.transform = "none";
    downloadBtn.style.boxShadow = "0 2px 24px rgba(0, 255, 194, 0.18)";
  });
  
  resultDiv.insertAdjacentElement("afterend", downloadBtn);

  // Show only after valid AI response
  const observer = new MutationObserver(() => {
    // Check if the content is NOT the loading message
    const text = resultDiv.textContent.trim();
    if (text && !text.includes("Generating your personalized diet plan...")) {
      downloadBtn.style.display = "inline-block";
    } else {
      downloadBtn.style.display = "none";
    }
  });
  // Observe for changes to the content of the result div
  observer.observe(resultDiv, { childList: true, subtree: true });

  // Generate PDF with full content and pagination (jspdf logic from workout.html)
  downloadBtn.addEventListener("click", () => {
    const pdf = new jsPDF({
      orientation: "p",
      unit: "mm",
      format: "a4",
    });

    // Use innerText to get the clean text without HTML tags
    const content = resultDiv.innerText || "No diet plan available.";

    const margin = 15;
    const maxWidth = 180;
    const lineHeight = 8;
    let y = 20;

    pdf.setFont("helvetica", "normal");
    pdf.setFontSize(12);

    // Splits the text into lines that fit the PDF width
    const lines = pdf.splitTextToSize(content, maxWidth);

    lines.forEach((line) => {
      // Check for page overflow
      if (y + lineHeight > 280) {
        pdf.addPage();
        y = 20; // Reset Y position for the new page
      }
      pdf.text(line, margin, y);
      y += lineHeight;
    });

    pdf.save("DietPlan.pdf");
  });
});
</script>


</body>
</html>